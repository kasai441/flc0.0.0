application: Flashcards
version: 0.0.0
date: 2020/1/31
author: kasai441


＜＜操作方法＞＞

■サインアップ、ログイン
　・サインアップ
    サインアップからユーザー登録を行うとログイン可能になります。
    サインアップにはメールの認証が必要となります。
  ・ログイン時追加機能
    ログイン時には単語の登録、編集、削除が可能になります。
    また、下記の機能が使用でき、練習の助けとなります。
      a ユーザーの単語一覧表示
      b 1日あたりの平均解答時間と平均練習回数を計算
      c 平均解答時間を計算
      d 新しく単語を追加する目安を計算
  ・パスワード再発行
    パスワードを忘れた場合は再発行することができます。

■単語帳
  ・難易度システム
    単語帳は「難しすぎず、簡単すぎない」ように
    難易度の自動修正システムをもっています。
    正解をすればするほど次回出題の日が遅くなり、
    逆に不正解が多くなると出題間隔が短くなります。
  ・連続正解ボーナス
    連続正解すると出題日が延長されます。
  ・単語ごとの判定
    単語ごとに難易度が設定され、
    得意な単語と苦手な単語が区別されます。
　・ログイン
    これらの機能はログインをして単語登録をすると使用されます。
    ログインをしていない場合はあらかじめ登録された単語で
    単語練習の動作を確認できますが難易度システムはありません。

■指標
  ・1日あたりの平均解答時間と平均練習回数
    1日にどれくらい練習をしたかが記録され学習の指標となります。
  ・平均解答時間
    平均解答時間が計算されます。
  ・新しく単語を追加する目安
    登録単語の量と練習の成績から
    何日ごとに新規単語登録すれば効率的かの目安を計算します。
    （この機能はあくまで概算であり正確性は低いです。）


＜＜アクション概要＞＞

  ■サインアップ、ログイン
    users_controller
      show ユーザー詳細画面
      new サインアップ画面
      create ユーザー追加
      edit ユーザー編集
      destroy ユーザー削除
    sessions_controller
      new ログイン画面
      create ログイン
      destroy ログアウト
    account_activations_controller
      edit メール認証
    password_resets_controller
      new メール入力画面
      create メール送信
      edit メール認証
      update パスワード再設定
    上記機能はRails Tutorialのコードに準じています。
    https://railstutorial.jp/

  ■メインビュー
    home_page_controller
      index
        ログイン時
          ログインユーザーの単語をデータベースから取得
          今日の単語を取得
          1日あたりの平均解答時間と平均練習回数を計算
          平均解答時間を計算
          新しく単語を追加する目安を計算
        非ログイン時
          サンプルユーザーの単語をデータベースから取得
          ユーザーIDをcookieに保存
          今日の単語を取得
          今日の単語をcookieに保存
      help ヘルプ画面

  ■単語帳
    quizcards_controller
      practice
        ログイン時
          今日の単語をデータベースから取得
          解答開始時間を取得
          練習画面
        非ログイン時
        　今日の単語をcookieから取得
          解答開始時間を取得
          練習画面
      judge
        ログイン時
          解答時間の計測
          正解時
            次回の練習日を計算
            練習済の単語を今日の単語からはずす（データベース）
          不正解時
            次回の練習日を計算
            練習済の単語を今日の単語からはずす（データベース
          解答時間をデータベースに記録
        非ログイン時
          解答時間の計測
          正解時
            練習済の単語を今日の単語からはずす（cookie）
          不正解時
            練習済の単語を今日の単語からはずす（cookie）
      show
        ログイン時
          今日の単語をデータベースから取得
        非ログイン時
        　今日の単語をcookieから取得
        正解、不正解の単語をcookieから取得
      （以下ログイン時）
      all ユーザーの単語を全て表示
      new 単語の作成画面
      create 単語の作成
      edit 単語の編集画面
      update 単語の編集
      destroy 単語の削除
      （以上ログイン時）


＜＜単語帳に関するモデル概要＞＞

  ■モデル構成
  Userが１対多の単語Quizcardを持ち、
  Quizcardが１対多の待機日数Waitdayを持っています。
  User
    1:N Quizcard
      1:N Waitday

  ■単語モデル
      Quizcard
        t.string "fail_seq" 過去に間違えた練習回（未使用）
        t.text "description" 単語の説明・問題文
        t.datetime "registered_at" 単語を記録した日時（未使用）
        t.string "name" 単語名
          (...省略...)
        t.integer "answer_time" 平均解答時間
        t.integer "user_id" User外部キー
        t.datetime "appearing_at" 次回練習日

  ■待機日数モデル
    待機日数は練習ごとにレコードが作成されます。
    各練習の成績、平均成績との乖離率によって求められます。
    用途は次回練習日の計算と過去の成績の算出です。
      Waitday
        t.integer "wait_sequence" 練習回
        t.integer "wait_day" 待機日数
        t.integer "quizcard_id" Quizcard外部キー
          (...省略...)

  ■ユーザーモデル
    ユーザーごとに単語帳に関するパラメーターを持っています。
      User
        t.string "name" ユーザー名
          (...省略...)
        t.integer "total_time" 総練習時間
        t.integer "practice_days" 総練習日数
        t.datetime "last_practiced_at" 直前の練習日
        t.integer "total_practices" 総練習回数


＜＜待機日数計算機能の概要＞＞

  ■待機日数の基本関数
    過去の全データを取得して基本関数を求めます。
    quizcard.rb
      get_model_sequences
        ユーザーの持つ全単語の全待機日数を平均して取得
      get_linear_function
        基本関数は一次関数を想定
        図：https://safe-river-31136.herokuapp.com/waitdays/chart
        x切片を算出し第1象限の値のみ取得
        前半平均座標(x1, y1)及び後半平均座標(x2, y2)を算出
        2座標から傾きを算出

  ■乖離率
    quizcard.rb
      calc_beta
        現在の待機日数と基本関数を比較して乖離率を算出
      prize_beta
        連続正解回数を計算して成長値を加味

  ■待機日数計算
    quizcard.rb
      calc_waitday
        正解時
          傾きを加算し乖離率を掛け合わせ待機日数を増加
        不正解時
          傾きを減算し乖離率を掛け合わせ待機日数を減少


＜＜追加目安機能の概要＞＞

  ■追加の目安
    home_page_controller
      index
        全単語から1日の必要練習時間を概算
          平均練習時間*単語量/平均待機期間
        新しい単語追加の目安を概算
        　（必要練習時間/実際練習時間）日に一度


＜＜その他＞＞

  ■大変だったところ
    ・レイアウト
      クッキーを使う場合とデータベースを使う場合で、別々のアクションを用意したところ、
      コードがほとんどかぶってしまいました。
      Don't Repeat Yourselfの思想に反するので
      リファクタリングしましたが2度手間となりました。
    ・Macに環境構築するところ
      RubyとRailsとgemのバージョンが合わず環境構築に難儀しました。
      AWS Cloud9でもMacでも作業できるように工夫しました。
    ・テストをいちいち書くところ
    　カバレッジは7,8割
    ・難易度システムをコード化するところ
      グラフで実データを確認し、一次関数の形をしていたので計算モデルとして採用しました。
      線形代数や微分積分、統計の知識がないので計算モデルの確からしさに疑問が残りました。
    ・単語追加の目安の計算
      評価システム同様、数学の知識の不足を感じました。
    ・データベースの構成
      単語モデルと、待機日数モデルを用意しましたが
      単語ひとつ練習ごとに1レコード増えるので
      Herokuのレコード制限10,000行を優に超える仕様となってしまいました。
      多くのユーザーが利用できるようにするために設計を見直す必要があります。
    ・EXCELからCSVに変換し、データベースに入れ込む作業
      初めは発音記号が文字化けしました。
      VBA、エンコード、改行設定を見直しました。
    ・画面レイアウト
      Bootstrapを使用しました。
      青系で統一したりボタンの色を決めるのに時間がかかりました。

　■よかったところ
    ・Ruby on Railsを設計からデプロイまで一周できた
    ・テストを書く癖がついた
    ・データベース設計を自作した
    ・Gitに慣れた

　■拡張案
    L-5 モバイル版
    L-5 ブラウザプラグイン
    L-4 辞書連携
    L-4 単語帳ユーザー間共有
    L-4 バージョンアップとデータベース移管機能
    L-3 グラフ機能
    L-2 待機日数モデルを廃止し単語モデルへ統合
    L-1 評価システムの精査
    L-1 デバッグ用日付変更
    L-1 テスト細かく
    L-1 ヒント連語対応
